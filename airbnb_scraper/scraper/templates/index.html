<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airbnb Scraper</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
        }
        .container {
            display: flex;
            justify-content: space-between; /* Space between form and map */
            align-items: flex-start; /* Align to the top */
            max-width: 1100px; /* Limit overall width */
            margin: 0 auto; /* Center the content */
        }
        .form-container {
            flex: 1;
            max-width: 400px; /* Adjust form width */
            margin-right: 50px; /* Space between form and map */
        }
        label {
            display: block;
            margin: 5px 0;
        }
        input[type="date"], input[type="number"], input[type="text"] {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
            max-width: 300px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #map-container {
            flex: 1.5; /* Slightly larger than form */
            display: flex;
            justify-content: center; /* Center map */
        }
        #map {
            height: 400px;
            width: 100%;
            max-width: 500px; /* Restrict max map size */
        }
        .results {
            text-align: center;
            margin-top: 30px;
        }
        .urls-list {
            list-style-type: none;
            padding-left: 0;
        }
        .urls-list li {
            margin-bottom: 10px;
        }
        .urls-list a {
            text-decoration: none;
            color: #007BFF;
        }
        .urls-list a:hover {
            text-decoration: underline;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>

    <h1>Airbnb Scraper</h1>

    <div class="container">
        <!-- Form container -->
        <div class="form-container">
            <form method="POST">
                {% csrf_token %}

                <label for="start_date">Start Date:</label>
                {{ form.start_date }}

                <label for="end_date">End Date:</label>
                {{ form.end_date }}

                <label for="num_adults">Number of Adults:</label>
                {{ form.num_adults }}

                <label for="max_price">Max Price ($):</label>
                {{ form.max_price }}

                <label for="ne_lat">NE Latitude:</label>
                {{ form.ne_lat }}

                <label for="ne_lng">NE Longitude:</label>
                {{ form.ne_lng }}

                <label for="sw_lat">SW Latitude:</label>
                {{ form.sw_lat }}

                <label for="sw_lng">SW Longitude:</label>
                {{ form.sw_lng }}

                <button type="submit">Search</button>
            </form>
        </div>

        <!-- Map container -->
        <div id="map-container">
            <div id="map"></div>
        </div>
    </div>

    <!-- Results Section -->
    {% if new_urls %}
    <div class="results">
        <h2>New Listings Found:</h2>
        <ul class="urls-list">
            {% for url in new_urls %}
                <li><a href="{{ url }}" target="_blank">{{ url }}</a></li>
            {% endfor %}
        </ul>
    </div>
    {% elif message %}
    <div class="message">
        <p>{{ message }}</p>
    </div>
    {% endif %}

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([{{ form.ne_lat.value|default:0 }}, {{ form.ne_lng.value|default:0 }}], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        map.on('moveend', function() {
            var bounds = map.getBounds();
            document.getElementById('id_ne_lat').value = bounds.getNorthEast().lat;
            document.getElementById('id_ne_lng').value = bounds.getNorthEast().lng;
            document.getElementById('id_sw_lat').value = bounds.getSouthWest().lat;
            document.getElementById('id_sw_lng').value = bounds.getSouthWest().lng;
        });
    </script>

</body>
</html>
